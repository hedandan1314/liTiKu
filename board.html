<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>看板管理</title>
    <link rel="stylesheet" href="./css/alert.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./lib/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="./lib/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="./lib/pagination/style/pagination.css">
    <style>
        table tr td {
            vertical-align: middle!important;
        }
        
        .main {
            background-image: url(images/bg_img.jpg);
            background-size: 100% 100%;
            /* background-repeat: no-repeat; */
        }
    </style>
</head>

<body>
    <!-- 左边的侧边栏 -->
    <div class="aside" id="aside">
        <!-- 左上部分的用户信息 -->
        <div class="profile">
            <div class="avatar">
                <img src="./images/head2.png" alt="" class='img-circle'>
            </div>
            <h4></h4>
        </div>

        <!--左下部分的导航-->
        <div class="menu">
            <ul>
                <li>
                    <a href="./basicInformation.html" class="slide" style="cursor: pointer;">基本信息</a>
                </li>
                <li>
                    <a href="./inboundManage.html" class="slide" style="cursor: pointer;">入库管理</a>
                </li>
                <li>
                    <a href="./outboundManage.html" class="slide" style="cursor: pointer;">出库管理</a>
                </li>
                <li>
                    <a href="./inventoryManage.html" class="slide" style="cursor: pointer;">盘点管理</a>
                </li>
                <!-- <li>
                    <a href="./cargoPositionManage.html" class="slide" style="cursor: pointer;">货位管理</a>
                </li>
                <li>
                    <a href="./transferLibraryManage.html" class="slide" style="cursor: pointer;">移库管理</a>
                </li>
                <li>
                    <a href="./detectionManage.html" class="slide" style="cursor: pointer;">检测管理</a>
                </li> -->
                <li>
                    <a href="./carryForwardManage.html" class="slide" style="cursor: pointer;">结转管理</a>
                </li>
                <!-- <li>
                    <a href="./inventoryWarning.html" class="slide" style="cursor: pointer;">库存预警</a>
                </li> -->
                <li>
                    <a href="./statisticalReports.html" class="slide" target="_blank" style="cursor: pointer;">统计报表</a>
                </li>
                <li class="active">
                    <a href="./board.html" class="slide" target="_blank" style="cursor: pointer;">看板管理</a>
                </li>
                <li>
                    <a class="slide" style="cursor: pointer;">系统管理<span class='arrow fa fa-angle-right pull-right'></span></a>
                    <ul style="display: none;" id="show" class="xz">
                        <li><a href="./conLog.html">系统日志</a> </li>
                        <li><a href="./inventoryWarning.html">库存预警</a> </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!-- 右边主体部分 -->
    <div class="main">
        <!-- 右边上部分工具部分 -->
        <div class="header">
            <!-- 导航条部分 -->
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <a class="navbar-brand" href="javascript:;"><span class='fa fa-navicon'></span></a>
                        <div id="marquee2" style="width: 300px; visibility: hidden;">
                            <ul>
                                <li>
                                    <a>库存上限预警<span style="margin-left: 200px;"></span></a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a data-toggle="modal" data-target="#personalInformation"> <span class='fa fa-user-circle'></span> 个人中心</a>
                            </li>
                            <li><a data-toggle="modal" data-target="#changePassword"><span class='fa fa-key fa-fw'></span>修改密码</a></li>
                            <li><a data-toggle="modal" data-target="#logOut"><span class='fa fa-sign-out'></span>退出</a></li>
                        </ul>
                    </div>
                    <!-- /.navbar-collapse -->
                </div>
                <!-- /.container-fluid -->
            </nav>

        </div>

        <!-- 右边下部分 ，网站的主体页面-->
        <div class="body">
            <!-- 面包屑导航 -->
            <!-- <ol class="breadcrumb">
                <li>看板</li>
            </ol> -->
            <!-- 面板，搜索框与表格 -->
            <div class="panel panel-default" style="background-color: transparent; border: 0;">
                <div class="panel-body" style="margin-top: 15px; margin-left: 17%; width: 80%;">
                    <!-- 表格2cc7cf -->
                    <table border="1" style="border: 2px solid #2cc7cf; width: 80%; color: #35f3ff; background-size: 100%; font-size: 18px;">
                        <caption style="text-align: center; color: #35f3ff;">
                            <h1>IIMT智能仓储系统</h1>
                            <span id="localTime" style="font-size: 16px;"></span>
                        </caption>
                        <tr>
                            <td width="90" style="min-width: 75px;" height="30"><strong>库存状态</strong></td>
                            <td colspan="5" style="border-top: 1px solid transparent; border-right: 1px solid transparent;">&nbsp;</td>
                        </tr>
                        <tr>
                            <td height="35" style="min-width: 75px;" colspan="2" align="center"><strong>商品名称</strong></td>
                            <td width="303" height="35" align="center"><strong>库存余量</strong></td>
                            <td width="190" style="min-width: 80px;" height="35" align="center"><strong>当日入库</strong></td>
                            <td width="170" style="min-width: 80px;" height="35" align="center"><strong>当日出库</strong></td>
                            <td width="176" height="35" align="center"><strong>单位</strong></td>
                        </tr>
                        <tbody id="tbody1">
                            <tr>
                                <td height="40" colspan="2" align="center">白酒</td>
                                <td height="40" align="center">1000</td>
                                <td height="40" align="center">200</td>
                                <td height="40" align="center">100</td>
                                <td height="40" align="center">箱</td>
                            </tr>
                            <tr>
                                <td height="40" colspan="2" align="center">&nbsp;</td>
                                <td height="40" align="center">&nbsp;</td>
                                <td height="40" align="center">&nbsp;</td>
                                <td height="40" align="center">&nbsp;</td>
                                <td height="40" align="center">&nbsp;</td>
                            </tr>
                        </tbody>
                        <tr>
                            <td colspan="6" height="40">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width="90" height="30"><strong>设备状态</strong></td>
                            <td colspan="5" style="border-right: 1px solid transparent;">&nbsp;</td>
                        </tr>
                        <tbody id="tbody2">
                            <tr>
                                <td height="35" colspan="3" align="center"><strong>当前任务</strong></td>
                                <td height="35" colspan="3" align="center"><strong>状态</strong></td>
                            </tr>
                            <tr>
                                <td height="40" class="AGV1" colspan="3" align="center">AGV1</td>
                                <td height="40" class="agvStatus1" colspan="3" align="center"></td>
                            </tr>
                            <tr>
                                <td height="40" class="AGV2" colspan="3" align="center">AGV2</td>
                                <td height="40" class="agvStatus2" colspan="3" align="center"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 个人信息 -->
    <div class="modal fade" id="personalInformation" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" style="outline: none;" class="close" data-dismiss="modal" aria-label="Close" onclick="closeWindow()" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">个人信息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="information">
                        <div class="form-group">
                            <label class="col-md-2 control-label">账号</label>
                            <div class="col-md-6">
                                <input type="text" id="userId" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">用户名</label>
                            <div class="col-md-6">
                                <input type="text" id="userName" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">角色</label>
                            <div class="col-md-6">
                                <select name="" id="multiSelect2" disabled style="margin-left: 5px;">
                                    <option value="0">管理员</option>
                                    <option value="1">普通用户</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">手机号码</label>
                            <div class="col-md-6">
                                <input type="text" id="phone" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">邮箱</label>
                            <div class="col-md-6">
                                <input type="text" id="email" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">备注</label>
                            <div class="col-md-6">
                                <input type="text" id="remark" disabled class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button style="outline: none;" type="button" class="btn btn-default" data-dismiss="modal" onclick="restoreSettings()" style="outline: none;">关闭</button>
                    <button style="outline: none;" type="button" class="btn btn-primary" id="informationEditor" onclick="myEditor()" style="outline: none;">编辑</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 退出登录 -->
    <div class="modal fade" id="logOut" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">退出登录</h4>
                </div>
                <div class="modal-body">
                    您是否确认退出此次登录？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="outline: none;">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" style="outline: none;" onclick="exitLogon()">确认</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改密码 -->
    <div class="modal fade" id="changePassword" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">修改密码</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="editorPwd">
                        <div class="form-group">
                            <label class="col-md-2 control-label">原密码</label>
                            <div class="col-md-6">
                                <input type="password" class="form-control" placeholder="原密码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">新密码</label>
                            <div class="col-md-6">
                                <input type="password" class="form-control" placeholder="新密码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">确认密码</label>
                            <div class="col-md-6">
                                <input type="password" class="form-control" placeholder="确认密码">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="outline: none;">关闭</button>
                    <button type="button" class="btn btn-primary save" style="outline: none;" onclick="changePwd()" data-dismiss="modal">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./lib/jquery/jquery-1.10.2.js"></script>
    <script src='./lib/bootstrap/dist/js/bootstrap.js'></script>
    <script src="./js/jquery.cookie.js"></script>
    <!-- ip地址 -->
    <script src="./js/index.js"></script>
    <!-- 公用的方法 -->
    <script src="./js/common.js"></script>
    <!-- cookie会话存储 -->
    <script src="./js/cookie.js"></script>
    <!-- 文字左右滚动 -->
    <script src="./js/jquery.kxbdMarquee.js" type="text/javascript" charset="utf-8"></script>

    <script src="./js/sidebarAnimation.js"></script>
    <script src='./js/godownManage.js'></script>
    <!-- 分页 -->
    <script src='./lib/pagination/script/jquery.pagination.js'></script>
    <script>
        // 文字左右滚动
        (function() {
            $("#marquee2").kxbdMarquee({
                isEqual: false
            });
        })();

        // 获取年月日时分
        function getDate() {
            var myDate = new Date();
            var year = myDate.getFullYear();
            var month = addZero(myDate.getMonth() + 1);
            var day = addZero(myDate.getDate());
            var hours = addZero(myDate.getHours());
            var minutes = addZero(myDate.getMinutes());
            $('#localTime').html(year + "-" + month + "-" + day + " " + hours + ":" + minutes);
        }
        getDate();

        function addZero(n) {
            return n < 10 ? "0" + n : n;
        }

        // 30秒更新一次
        setInterval(function() {
            getDate();
        }, 30000)

        // 初始化数据
        function initAjax() {
            var parameter = {};
            $.ajax({
                type: 'POST',
                url: ipAddress + '/report/queryBoardStats.do',
                data: parameter,
                success: function(result) {
                    console.log('result=', result);
                    if (result) {
                        var html = '';
                        $('#tbody1 tr').remove();
                        for (var i = 0; i < result.length; i++) {
                            html += '<tr>' +
                                '<td height="40" colspan="2" align="center">' + result[i].productName +
                                '</td>' +
                                '<td height="40" align="center">' + result[i].currentInventory +
                                '</td>' +
                                '<td height="40" align="center">' + result[i].totalInbound +
                                '</td>' +
                                '<td height="40" align="center">' + result[i].totalOutbound +
                                '</td>' +
                                '<td height="40" align="center">' + result[i].productUnit +
                                '</td>' +
                                '</tr>'
                        }
                        $('#tbody1').append(html);
                    }
                },
                error: function() {
                    alert('失败！')
                }
            })
        }
        initAjax();
        initAjax2();
        // 每隔十秒刷新一次数据
        setInterval(function() {
            initAjax();
            initAjax2();
        }, 10000)

        function initAjax2() {
            var parameter = {};
            $.ajax({
                type: 'GET',
                url: ipAddress + '/agvStatus.do',
                data: parameter,
                success: function(result) {
                    console.log('result=', result);
                    if (result) {
                        // 判断AGV1
                        if (result.agvStatus1 != '' && result.agvStatus1 != null) {
                            if (result.agvStatus1 == 1) {
                                $('.agvStatus1').html('任务接收成功');
                            } else if (result.agvStatus1 == 2) {
                                $('.agvStatus1').html('输送中');
                            } else if (result.agvStatus1 == 4) {
                                $('.agvStatus1').html('完成任务');
                            } else {
                                $('.agvStatus1').html('异常');
                            }
                        } else {
                            $('.agvStatus1').html('数据异常');
                        }
                        // 判断AGV2
                        if (result.agvStatus2 != '' && result.agvStatus2 != null) {
                            if (result.agvStatus2 == 8) {
                                $('.agvStatus2').html('任务接收成功');
                            } else if (result.agvStatus2 == 16) {
                                $('.agvStatus2').html('输送中');
                            } else if (result.agvStatus2 == 32) {
                                $('.agvStatus2').html('完成任务');
                            } else {
                                $('.agvStatus2').html('异常');
                            }
                        } else {
                            $('.agvStatus2').html('数据异常');
                        }

                    } else {
                        alert('数据异常！');
                    }
                },
                error: function() {
                    alert('失败！')
                }
            })
        }
    </script>
</body>

</html>