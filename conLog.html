<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录日志</title>
    <link rel="stylesheet" href="./css/alert.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./lib/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="./lib/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="./lib/pagination/style/pagination.css">
    <style>
        table tr td {
            vertical-align: middle!important;
        }
    </style>
</head>

<body>
    <!-- 左边的侧边栏 -->
    <div class="aside" id="aside">
        <!-- 左上部分的用户信息 -->
        <div class="profile">
            <div class="avatar" id="aa">
                <img src="./images/head2.png" alt="" class='img-circle'>
            </div>
            <h4></h4>
        </div>

        <!--左下部分的导航-->
        <div class="menu">
            <ul>
                <li>
                    <a href="./basicInformation.html" class="slide" style="cursor: pointer;">基本信息</a>
                </li>
                <li>
                    <a href="./inboundManage.html" class="slide" style="cursor: pointer;">入库管理</a>
                </li>
                <li>
                    <a href="./outboundManage.html" class="slide" style="cursor: pointer;">出库管理</a>
                </li>
                <li>
                    <a href="./inventoryManage.html" class="slide" style="cursor: pointer;">盘点管理</a>
                </li>
                <!-- <li>
                    <a href="./cargoPositionManage.html" class="slide" style="cursor: pointer;">货位管理</a>
                </li>
                <li>
                    <a href="./transferLibraryManage.html" class="slide" style="cursor: pointer;">移库管理</a>
                </li>
                <li>
                    <a href="./detectionManage.html" class="slide" style="cursor: pointer;">检测管理</a>
                </li> -->
                <li>
                    <a href="./carryForwardManage.html" class="slide" style="cursor: pointer;">结转管理</a>
                </li>
                <!-- <li>
                    <a href="./inventoryWarning.html" class="slide" style="cursor: pointer;">库存预警</a>
                </li> -->
                <li>
                    <a href="./statisticalReports.html" class="slide" target="_blank" style="cursor: pointer;">统计报表</a>
                </li>
                <li>
                    <a href="./board.html" class="slide" target="_blank" style="cursor: pointer;">看板管理</a>
                </li>
                <li class="active">
                    <a class="slide" style="cursor: pointer;">系统管理<span class='arrow fa fa-angle-right pull-right'></span></a>
                    <ul style="display: none;" id="show" class="xz">
                        <li><a href="./conLog.html">系统日志</a> </li>
                        <li><a href="./inventoryWarning.html" style="background-color: #2f4050;">库存预警</a> </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!-- 右边主体部分 -->
    <div class="main">
        <!-- 右边上部分工具部分 -->
        <div class="header">
            <!-- 导航条部分 -->
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <a class="navbar-brand" href="javascript:;"><span class='fa fa-navicon'></span></a>
                        <div id="marquee2" style="width: 300px; visibility: hidden;">
                            <ul>
                                <li>
                                    <a>库存上限预警<span style="margin-left: 200px;"></span></a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a data-toggle="modal" data-target="#personalInformation"> <span class='fa fa-user-circle'></span> 个人中心</a>
                            </li>
                            <li><a data-toggle="modal" data-target="#changePassword"><span class='fa fa-key fa-fw'></span>修改密码</a></li>
                            <li><a data-toggle="modal" data-target="#logOut"><span class='fa fa-sign-out'></span>退出</a></li>
                        </ul>
                    </div>
                    <!-- /.navbar-collapse -->
                </div>
                <!-- /.container-fluid -->
            </nav>

        </div>

        <!-- 右边下部分 ，网站的主体页面-->
        <div class="body">
            <!-- 面包屑导航 -->
            <ol class="breadcrumb">
                <!-- <li>首页</li> -->
                <li>系统日志</li>
            </ol>
            <!-- 面板，搜索框与表格 -->
            <div class="panel panel-default">

                <div class="panel-body" style="margin-top: 15px;">

                    <!-- 搜索框 -->
                    <div class="col-md-12">
                        <form class="form-inline">
                            <div class="form-group">
                                <label class="special" for="exampleInputName">账号查询：</label>
                                <input type="text" class="form-control" id="exampleInputName">
                            </div>
                            <button id="submits" type="button" class="btn btn-primary" style='margin-left:20px; outline: none;'>查询</button>
                        </form>

                    </div>
                </div>
                <div class="panel-body" style="margin-top: 15px;">
                    <!-- 表格 -->
                    <table class="table table-bordered table-hover table-striped" id="myTable">
                        <thead>
                            <th>序号</th>
                            <th>账号</th>
                            <th>登录时间</th>
                            <th>ip地址</th>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <!-- 分页 -->
                    <div class="panel-body" style="margin-top: 15px;">
                        <div class="M-box" style='float: right;'></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 提交 -->
    <div class="modal fade" id="refer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">是否提交？</h4>
                </div>
                <div class="modal-body">
                    您是否确认提交本行数据？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="outline: none;">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" style="outline: none;">确认</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete -->
    <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">是否删除？</h4>
                </div>
                <div class="modal-body">
                    您是否确认删除本行数据？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="outline: none;">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" style="outline: none;" onclick="sureDelete()">确认</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 个人信息 -->
    <div class="modal fade" id="personalInformation" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" style="outline: none;" class="close" data-dismiss="modal" aria-label="Close" onclick="closeWindow()" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">个人信息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="information">
                        <div class="form-group">
                            <label class="col-md-2 control-label">账号</label>
                            <div class="col-md-6">
                                <input type="text" id="userId" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">用户名</label>
                            <div class="col-md-6">
                                <input type="text" id="userName" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">角色</label>
                            <div class="col-md-6">
                                <select name="" id="multiSelect2" disabled style="margin-left: 5px;">
                                    <option value="0">管理员</option>
                                    <option value="1">普通用户</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">手机号码</label>
                            <div class="col-md-6">
                                <input type="text" id="phone" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">邮箱</label>
                            <div class="col-md-6">
                                <input type="text" id="email" disabled class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">备注</label>
                            <div class="col-md-6">
                                <input type="text" id="remark" disabled class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button style="outline: none;" type="button" class="btn btn-default" data-dismiss="modal" onclick="restoreSettings()" style="outline: none;">关闭</button>
                    <button style="outline: none;" type="button" class="btn btn-primary" id="informationEditor" onclick="myEditor()" style="outline: none;">编辑</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 退出登录 -->
    <div class="modal fade" id="logOut" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">退出登录</h4>
                </div>
                <div class="modal-body">
                    您是否确认退出此次登录？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="outline: none;">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" style="outline: none;" onclick="exitLogon()">确认</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改密码 -->
    <div class="modal fade" id="changePassword" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="outline: none;"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">修改密码</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="editorPwd">
                        <div class="form-group">
                            <label class="col-md-2 control-label">原密码</label>
                            <div class="col-md-6">
                                <input type="password" class="form-control" placeholder="原密码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">新密码</label>
                            <div class="col-md-6">
                                <input type="password" class="form-control" placeholder="新密码">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">确认密码</label>
                            <div class="col-md-6">
                                <input type="password" class="form-control" placeholder="确认密码">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="outline: none;">关闭</button>
                    <button type="button" class="btn btn-primary save" style="outline: none;" onclick="changePwd()" data-dismiss="modal">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./lib/jquery/jquery-1.10.2.js"></script>
    <script src='./lib/bootstrap/dist/js/bootstrap.js'></script>
    <script src="./js/jquery.cookie.js"></script>
    <!-- ip地址 -->
    <script src="./js/index.js"></script>
    <!-- 公用的方法 -->
    <script src="./js/common.js"></script>
    <!-- cookie会话存储 -->
    <script src="./js/cookie.js"></script>
    <!-- 文字左右滚动 -->
    <script src="./js/jquery.kxbdMarquee.js" type="text/javascript" charset="utf-8"></script>

    <script src="./js/sidebarAnimation.js"></script>
    <script src='./js/godownManage.js'></script>
    <!-- 分页 -->
    <script src='./lib/pagination/script/jquery.pagination.js'></script>
    <script>
        // 文字左右滚动
        (function() {
            $("#marquee2").kxbdMarquee({
                isEqual: false
            });
        })();

        $(function() {
            initAjax();
            // 初始化日志列表
            function initAjax() {
                var parameter = {
                    "pageIndex": 1,
                    "recordCount": 10,
                    "criteria": {
                        "userNo": exampleUserNo
                    }
                }

                $.ajax({
                    type: 'POST',
                    url: ipAddress + '/journal/queryJournals.do',
                    data: JSON.stringify(parameter),
                    contentType: 'application/json;charset=UTF-8',
                    success: function(result) {
                        console.log('result=', result);
                        if (result) {
                            if (result.data.length == 0) {
                                parameter.pageIndex -= 1
                                if (parameter.pageIndex != 0) {
                                    initAjax();
                                }
                            }
                            $("#myTable tbody tr").remove();
                            pageIndex = result.currentPage;
                            for (var i = 0; i < result.data.length; i++) {
                                var html = '<tr>' +
                                    '<td>' + (pageIndex * 10 - 9 + i) +
                                    '</td>' +
                                    '<td>' + result.data[i].userNo +
                                    '</td>' +
                                    '<td>' + (result.data[i].loginTime == null ? '' : result.data[i].loginTime) +
                                    '</td>' +
                                    '<td>' + (result.data[i].ipAddress == null ? '' : result.data[i].ipAddress) +
                                    '</td>' +
                                    '</tr>'
                                $('#myTable tbody').append(html)
                            }

                            //分页
                            $('.M-box').pagination({
                                pageCount: result.totalPage, //总页码
                                jump: true, //是否开启跳转，true是开启
                                coping: true, //是否开启首页和末页，此处开启
                                homePage: '首页',
                                endPage: '末页',
                                prevContent: '上页',
                                nextContent: '下页',
                                current: parameter.pageIndex, //当前页码
                                callback: function(api) { //这是一个回调函数					
                                    parameter.pageIndex = api.getCurrent();
                                    $.ajax({
                                        type: 'POST',
                                        url: ipAddress + '/journal/queryJournals.do',
                                        data: JSON.stringify(parameter),
                                        contentType: 'application/json;charset=UTF-8',
                                        success: function(result) {
                                            if (result.data.length == 0) {
                                                parameter.pageIndex -= 1
                                                if (parameter.pageIndex != 0) {
                                                    initAjax();
                                                }
                                            }
                                            pageIndex = result.currentPage;
                                            $("#myTable tbody tr").remove();
                                            for (var i = 0; i < result.data.length; i++) {
                                                var html = '<tr>' +
                                                    '<td>' + (pageIndex * 10 - 9 + i) +
                                                    '</td>' +
                                                    '<td>' + result.data[i].userNo +
                                                    '</td>' +
                                                    '<td>' + (result.data[i].loginTime == null ? '' : result.data[i].loginTime) +
                                                    '</td>' +
                                                    '<td>' + (result.data[i].ipAddress == null ? '' : result.data[i].ipAddress) +
                                                    '</td>' +
                                                    '</tr>'
                                                $('#myTable tbody').append(html)
                                            }
                                        },
                                        error: function() {
                                            alert('失败')
                                        }
                                    })
                                }
                            });
                        } else {
                            alert('数据异常！')
                        }
                    },
                    error: function() {
                        alert('失败！')
                    }
                })
            }


            // 根据账号查询
            var exampleUserNo;
            $('#submits').click(function() {
                exampleUserNo = $('#exampleInputName').val();
                initAjax();
            })
        })
    </script>
</body>

</html>